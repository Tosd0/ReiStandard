# ReiStandard

**ä¸»åŠ¨æ¶ˆæ¯ API æ ‡å‡†**ï¼šç»Ÿä¸€çš„å®šæ—¶æ¶ˆæ¯æ¨é€ API è§„èŒƒï¼Œæ”¯æŒç«¯åˆ°ç«¯åŠ å¯†ã€å¤šæ¶ˆæ¯ç±»å‹å’Œ Serverless éƒ¨ç½²ã€‚æœ€å°åªéœ€è¦ä¸€ä¸ªæ•°æ®åº“å°±èƒ½æŒç»­è·‘ï¼Œä¸ªäººä½¿ç”¨ä¸ç”¨èŠ±é’±ç»™åˆ«çš„åœ°æ–¹ï¼

## ğŸ“¦ å½“å‰ Packages

| Package | ç‰ˆæœ¬ | è¯´æ˜ | æ–‡æ¡£ |
|---------|------|------|------|
| `@rei-standard/amsg-server` | `1.2.2` | ä¸»åŠ¨æ¶ˆæ¯ API æœåŠ¡ç«¯ SDKï¼ˆæ ‡å‡† handler + DB adapterï¼‰ | [packages/rei-standard-amsg/server/README.md](./packages/rei-standard-amsg/server/README.md) |
| `@rei-standard/amsg-client` | `1.2.2` | æµè§ˆå™¨ç«¯ SDKï¼ˆåŠ å¯†ã€è¯·æ±‚å°è£…ã€Push è®¢é˜…ï¼‰ | [packages/rei-standard-amsg/client/README.md](./packages/rei-standard-amsg/client/README.md) |
| `@rei-standard/amsg-sw` | `1.2.2` | Service Worker æ’ä»¶ï¼ˆæ¨é€å±•ç¤ºã€ç¦»çº¿é˜Ÿåˆ—ï¼‰ | [packages/rei-standard-amsg/sw/README.md](./packages/rei-standard-amsg/sw/README.md) |

æŒ‰åŠŸèƒ½æ‹†åˆ†åï¼Œä¸»åº”ç”¨ç›´æ¥æŒ‰åŒ…å¼•ç”¨ï¼š

- `@rei-standard/amsg-server`ï¼š`createReiServer`ï¼Œç”¨äºåˆ›å»ºæ ‡å‡† API å¤„ç†å™¨
- `@rei-standard/amsg-client`ï¼š`ReiClient`ï¼Œç”¨äºå‰ç«¯åŠ å¯†å’Œ API è°ƒç”¨
- `@rei-standard/amsg-sw`ï¼š`installReiSW`ï¼Œç”¨äº SW æ¨é€å±•ç¤ºå’Œç¦»çº¿è¯·æ±‚é˜Ÿåˆ—

å¿«é€Ÿå¼•ç”¨ç¤ºä¾‹ï¼š

```js
import { createReiServer } from '@rei-standard/amsg-server';
import { ReiClient } from '@rei-standard/amsg-client';
import { installReiSW } from '@rei-standard/amsg-sw';
```

å¦‚æœä½ è¦çœ‹å­—æ®µè¯´æ˜ã€è¯·æ±‚å¤´è¦æ±‚ã€ä¸»åº”ç”¨æ¥å…¥æ–¹å¼ï¼Œè¯·ç›´æ¥çœ‹ï¼š
[SDK æ€»è§ˆæ–‡æ¡£](./packages/rei-standard-amsg/README.md)ã€‚

---

> **âš ï¸ AI ç¼–ç¨‹åŠ©æ‰‹ä½¿ç”¨é¡»çŸ¥**
>
> æœ¬ä»“åº“æ˜¯ **æŠ€æœ¯æ ‡å‡†è§„èŒƒæ–‡æ¡£**ï¼Œå®šä¹‰äº†ä¸»åŠ¨æ¶ˆæ¯ API çš„æ ‡å‡†æ¥å£ã€æ•°æ®ç»“æ„å’Œå®ç°è§„èŒƒã€‚
>
> **è§„èŒƒ**ï¼š
> - âœ… æœ¬æ ‡å‡†çš„ API ç«¯ç‚¹ã€è¯·æ±‚/å“åº”æ ¼å¼ã€å­—æ®µåç§°ã€æ•°æ®ç»“æ„ç­‰å‡ä¸º **æ—¢å®šæ ‡å‡†**ï¼Œé™¤éæœ‰æ˜ç¡®éœ€æ±‚æˆ–é”™è¯¯ï¼Œå¦åˆ™ **ä¸åº”ä¿®æ”¹**
> - âœ… åœ¨å®ç°ä»£ç æ—¶ï¼Œåº” **ä¸¥æ ¼éµå¾ª** æœ¬æ ‡å‡†å®šä¹‰çš„æ¥å£å’Œæ•°æ®ç»“æ„
> - âœ… å¦‚éœ€æ‰©å±•åŠŸèƒ½ï¼Œåº”é€šè¿‡ **å¯é€‰å­—æ®µ** æˆ– **å…ƒæ•°æ®ï¼ˆmetadataï¼‰** å®ç°ï¼Œè€Œéä¿®æ”¹æ ‡å‡†å­—æ®µ
> - âœ… å¦‚æœä½¿ç”¨å¯é€‰å­—æ®µå®ç°çš„åŠŸèƒ½å…·æœ‰æ™®éåº”ç”¨åœºæ™¯ï¼Œåº”æé†’å¼€å‘è€…å‘ä»“åº“æäº¤ **FEATURE REQUEST**ï¼Œä»¥ä¾¿åœ¨åç»­ç‰ˆæœ¬çš„æ ‡å‡†ä¸­æ­£å¼å®ç°
> - âŒ ä¸è¦éšæ„ä¿®æ”¹æ ‡å‡†å®šä¹‰çš„å­—æ®µåç§°ã€æ•°æ®ç±»å‹ã€API ç«¯ç‚¹è·¯å¾„ç­‰æ ¸å¿ƒè§„èŒƒ
> - âŒ ä¸è¦åœ¨æ²¡æœ‰å……åˆ†è®¨è®ºçš„æƒ…å†µä¸‹é‡æ„æ ‡å‡†çš„æ•´ä½“ç»“æ„
>
> **å‘ç°é—®é¢˜æ—¶çš„å¤„ç†**ï¼š
> - å¦‚æœå‘ç°æ ‡å‡†ä¸­å­˜åœ¨é”™è¯¯ã€ä¸åˆç†ä¹‹å¤„ï¼Œæˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œåº”å»ºè®®å¼€å‘è€…è”ç³»ä»“åº“è´Ÿè´£äººè®¨è®º
> - **ä¸åº”è¯¥ç›´æ¥ä¿®æ”¹æ ‡å‡†æ–‡æ¡£**ï¼Œæ ‡å‡†çš„ä¿®æ”¹éœ€è¦ç»è¿‡ä»“åº“è´Ÿè´£äººçš„å®¡æ ¸å’Œæ‰¹å‡†

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸ¯ å¿«é€Ÿå¼€å§‹

[SDK æ€»è§ˆ](./packages/rei-standard-amsg/README.md) â†’ [éƒ¨ç½²æ•™ç¨‹](./examples/README.md) â†’ [æœ¬åœ°æµ‹è¯•](./docs/TEST_README.md)

### ğŸ“– æ ¸å¿ƒæ–‡æ¡£

#### 1. [API æŠ€æœ¯è§„èŒƒ](./standards/active-messaging-api.md) - åç«¯ API æ ‡å‡†
å®Œæ•´çš„åç«¯ API æŠ€æœ¯è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š
- API ç«¯ç‚¹çš„è¯¦ç»†å®šä¹‰ï¼ˆè¯·æ±‚/å“åº”æ ¼å¼ã€é”™è¯¯ä»£ç ï¼‰
- ç«¯åˆ°ç«¯åŠ å¯†æ¶æ„ï¼ˆAES-256-GCMï¼‰
- å››ç§æ¶ˆæ¯ç±»å‹ï¼ˆfixedã€promptedã€autoã€instantï¼‰
- è®¤è¯ä¸æˆæƒä½“ç³»
- æ•°æ®åº“ Schema
- å®‰å…¨è€ƒè™‘å’Œæœ€ä½³å®è·µ

#### 1.5. [Service Worker è§„èŒƒ](./standards/service-worker-specification.md) - å‰ç«¯ SW æ ‡å‡†
å®Œæ•´çš„ Service Worker å®ç°è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š
- æ¨é€é€šçŸ¥æ¥æ”¶å’Œæ˜¾ç¤º
- ç¼“å­˜ç­–ç•¥å’Œèµ„æºç®¡ç†
- ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†
- æ¶ˆæ¯é€šä¿¡æœºåˆ¶
- ç¦»çº¿åŠŸèƒ½æ”¯æŒ
- æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è€ƒè™‘

#### 2. [éƒ¨ç½²æ•™ç¨‹](./examples/README.md) - å¿«é€Ÿéƒ¨ç½²æŒ‡å—
5 æ­¥å¿«é€Ÿéƒ¨ç½²åˆ° Serverless å¹³å°ï¼š
- å¤åˆ¶æ–‡ä»¶åˆ°é¡¹ç›®
- å®‰è£…ä¾èµ–
- é…ç½®ç¯å¢ƒå˜é‡
- åˆå§‹åŒ–æ•°æ®åº“
- é…ç½® Cron Job

é€‚ç”¨å¹³å°ï¼šVercelã€Netlifyã€Github Pages ç­‰

#### 3. [æœ¬åœ°æµ‹è¯•](./docs/TEST_README.md) - å¼€å‘ç¯å¢ƒæµ‹è¯•
æœ¬åœ°æµ‹è¯•è„šæœ¬ä½¿ç”¨æŒ‡å—ï¼š
- å®Œæ•´çš„ç«¯ç‚¹æµ‹è¯•ï¼ˆå…¨éƒ¨æ ‡å‡† API ç«¯ç‚¹ï¼‰
- åŠ å¯†/è§£å¯†éªŒè¯
- å‚æ•°éªŒè¯æµ‹è¯•
- è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®

é€‚åˆï¼šå¼€å‘æ—¶å¿«é€Ÿè¿­ä»£éªŒè¯

#### 4. [ç”Ÿäº§ç›‘æ§](./docs/VERCEL_TEST_DEPLOY.md) - æŒç»­å¥åº·æ£€æŸ¥
å°†æµ‹è¯•ç«¯ç‚¹éƒ¨ç½²ä¸º Serverless Functionï¼š
- ç”Ÿäº§ç¯å¢ƒæŒç»­ç›‘æ§
- CI/CD é›†æˆ
- ç›‘æ§å‘Šè­¦é…ç½®
- ä¸€é”®è®¿é—®æµ‹è¯•ç»“æœ

é€‚åˆï¼šç”Ÿäº§ç¯å¢ƒ API å¥åº·çŠ¶æ€ç›‘æ§

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### éƒ¨ç½² API

```bash
# 1. å¤åˆ¶å®ç°ä»£ç åˆ°é¡¹ç›®
cp -r examples/api ./
cp -r examples/lib ./

# 2. å®‰è£…ä¾èµ–ï¼ˆServerless å¹³å°é…ç½® package.jsonï¼‰
npm install web-push @neondatabase/serverless

# 3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env.localï¼‰
DATABASE_URL=postgresql://...
VAPID_EMAIL=your@email.com
NEXT_PUBLIC_VAPID_PUBLIC_KEY=...
VAPID_PRIVATE_KEY=...
CRON_SECRET=$(openssl rand -base64 32)

# 4. åˆå§‹åŒ–æ•°æ®åº“
curl -X GET "http://localhost:3000/api/v1/init-database"

# 5. ä¸€æ¬¡æ€§åˆå§‹åŒ–ç³»ç»Ÿå¯†é’¥ï¼ˆä»…é¦–æ¬¡æ‰§è¡Œï¼‰
curl -X POST "http://localhost:3000/api/v1/init-master-key"

# 6. éƒ¨ç½²åˆ° Vercel
vercel --prod
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒï¼š[examples/README.md](./examples/README.md)

### æµ‹è¯•éªŒè¯

**æœ¬åœ°æµ‹è¯•**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š
```bash
cd tests
./run-test.sh
```

**ç”Ÿäº§ç›‘æ§**ï¼ˆéƒ¨ç½²åï¼‰ï¼š
```bash
# æµè§ˆå™¨è®¿é—®
https://your-domain.com/api/test-active-messaging
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
ReiStandard/
â”œâ”€â”€ standards/
â”‚   â”œâ”€â”€ active-messaging-api.md          # API æŠ€æœ¯æ ‡å‡†è§„èŒƒï¼ˆåç«¯ï¼‰
â”‚   â””â”€â”€ service-worker-specification.md  # Service Worker è§„èŒƒï¼ˆå‰ç«¯ï¼‰
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ api/v1/                          # API å®ç°ç¤ºä¾‹ä»£ç 
â”‚   â”‚   â”œâ”€â”€ init-database.js             # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ init-master-key.js           # ç³»ç»Ÿå¯†é’¥ä¸€æ¬¡æ€§åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ get-user-key.js              # ç”¨æˆ·å¯†é’¥åˆ†å‘
â”‚   â”‚   â”œâ”€â”€ schedule-message.js          # åˆ›å»ºå®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ send-notifications.js        # Cron è§¦å‘å¤„ç†
â”‚   â”‚   â”œâ”€â”€ update-message.js            # æ›´æ–°ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ cancel-message.js            # å–æ¶ˆä»»åŠ¡
â”‚   â”‚   â””â”€â”€ messages.js                  # æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨
â”‚   â””â”€â”€ README.md                        # éƒ¨ç½²æ•™ç¨‹
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ rei-standard-amsg/
â”‚       â”œâ”€â”€ README.md                    # SDK åŒ…æ€»è§ˆï¼ˆèšåˆæ–‡æ¡£ï¼‰
â”‚       â”œâ”€â”€ server/                      # æœåŠ¡ç«¯ SDK åŒ…
â”‚       â”œâ”€â”€ client/                      # æµè§ˆå™¨ Client SDK åŒ…
â”‚       â””â”€â”€ sw/                          # Service Worker SDK åŒ…
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ TEST_README.md                   # æœ¬åœ°æµ‹è¯•æŒ‡å—
â”‚   â””â”€â”€ VERCEL_TEST_DEPLOY.md            # ç”Ÿäº§ç›‘æ§éƒ¨ç½²
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test-active-messaging-api.js     # æœ¬åœ°æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test-vercel-function.js          # Vercel Function æµ‹è¯•ç«¯ç‚¹
â”‚   â””â”€â”€ run-test.sh                      # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â””â”€â”€ README.md                            # æœ¬æ–‡ä»¶
```

---

## ğŸ”— å¤–éƒ¨èµ„æº

- **VAPID å¯†é’¥ç”Ÿæˆ**ï¼šhttps://vapidkeys.com
- **Web Push åè®®**ï¼šhttps://datatracker.ietf.org/doc/html/rfc8030
- **Vercel æ–‡æ¡£**ï¼šhttps://vercel.com/docs
- **Next.js æ–‡æ¡£**ï¼šhttps://nextjs.org/docs

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿å¯¹æœ¬æ ‡å‡†æå‡ºæ”¹è¿›å»ºè®®ï¼š
1. æäº¤ Issue æè¿°é—®é¢˜æˆ–æ”¹è¿›å»ºè®®
2. Fork ä»“åº“å¹¶åˆ›å»º Pull Request
3. æˆ–åœ¨ QQ ç¾¤å†…æå‡ºå»ºè®®

---

## ğŸ“„ è®¸å¯

æœ¬æ ‡å‡†é‡‡ç”¨ **CC BY-NC-SA 4.0**ï¼ˆCreative Commons ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«ï¼‰åè®®å‘å¸ƒã€‚

---

## ğŸ‘¥ è‡´è°¢

æœ¬æ ‡å‡†åŸºäº Whaleå°æ‰‹æœº å›¢é˜Ÿçš„ä¸»åŠ¨æ¶ˆæ¯å®ç°ç»éªŒæ€»ç»“è€Œæˆã€‚ç‰¹åˆ«æ„Ÿè°¢ï¼šTOï¼ˆå‘èµ·äººï¼‰ã€æ±¤åœ†ã€è„†è„†æœºã€kokoã€ç³¯ç±³æœºã€33å°æ‰‹æœºã€Ravenã€toufuã€è²æ´›å›¾ç­‰è€å¸ˆçš„å°æ‰‹æœºé¡¹ç›®çš„ç§¯æå‚ä¸å’Œæ”¯æŒã€‚
